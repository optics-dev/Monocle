<!DOCTYPE html><html><head><title>Monocle: Unsafe Module</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="optics.dev" /><meta name="description" content="Optics library for Scala" /><meta name="og:image" content="/Monocle/img/poster.png" /><meta name="image" property="og:image" content="/Monocle/img/poster.png" /><meta name="og:title" content="Monocle: Unsafe Module" /><meta name="title" property="og:title" content="Monocle: Unsafe Module" /><meta name="og:site_name" content="Monocle" /><meta name="og:url" content="https://www.optics.dev/Monocle/" /><meta name="og:type" content="website" /><meta name="og:description" content="Optics library for Scala" /><link rel="icon" type="image/png" href="/Monocle/img/favicon.png" /><meta name="twitter:title" content="Monocle: Unsafe Module" /><meta name="twitter:image" content="/Monocle/img/poster.png" /><meta name="twitter:description" content="Optics library for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/Monocle/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/Monocle/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/Monocle/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/Monocle/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/Monocle/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/Monocle/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/Monocle/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/Monocle/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/Monocle/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/Monocle/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/Monocle/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/Monocle/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/Monocle/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/Monocle/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/Monocle/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/Monocle/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/Monocle/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/Monocle/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/Monocle/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/Monocle/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/Monocle/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/Monocle/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/Monocle/" class="brand"><div class="brand-wrapper"></div><span>Monocle</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/Monocle/modules.html" title="Modules" class="">Modules</a></div>    <div class="sidebar-nav-item  "><a href="/Monocle/optics.html" title="Optics ..." class="">Optics ...</a></div>  <div class="sidebar-nav-item  "><a href="/Monocle/typeclasses.html" title="Typeclasses ..." class="">Typeclasses ...</a></div>  <div class="sidebar-nav-item  "><a href="/Monocle/examples.html" title="Examples ..." class="">Examples ...</a></div>  <div class="sidebar-nav-item  "><a href="/Monocle/faq.html" title="FAQ" class="">FAQ</a></div> <div class="sidebar-nav-item  "><a href="/Monocle/release_notes.html" title="Release Notes" class="">Release Notes</a></div> <div class="sidebar-nav-item  "><a href="/Monocle/learning_resources.html" title="Learning Resources" class="">Learning Resources</a></div> <div class="sidebar-nav-item  "><a href="/Monocle/adopters.html" title="Adopters" class="">Adopters</a></div> <div class="sidebar-nav-item active "><a href="/Monocle/unsafe_module.html" title="Unsafe Module" class="active">Unsafe Module</a></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/optics-dev/Monocle" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/optics-dev/Monocle" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="optics-dev" data-github-repo="Monocle"><div class="content-wrapper"><section><h2 id="unsafe-module">Unsafe module</h2>

<p>The <code class="highlighter-rouge">unsafe</code> module contains <code class="highlighter-rouge">Optics</code> that do not fully satisfy the set of <code class="highlighter-rouge">Optics</code> <code class="highlighter-rouge">Laws</code> of the <code class="highlighter-rouge">core</code> module.</p>

<p>These <code class="highlighter-rouge">Optics</code> hence require additional care from the end user to avoid unlawful usages as those are not enforced by the library.</p>

<p>The module currently defines one <code class="highlighter-rouge">Optic</code>, <code class="highlighter-rouge">UnsafeSelect</code>, but more will be added as required.</p>

<h2 id="unsafeselect">UnsafeSelect</h2>

<p><code class="highlighter-rouge">UnsafeSelect</code> allows to create a <code class="highlighter-rouge">Prism</code> based on a predicate. Letâ€™s have a look at a simple example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre></div></div>

<p>Using an <code class="highlighter-rouge">UnsafeSelect</code> we can select all <code class="highlighter-rouge">Person</code> with <code class="highlighter-rouge">age &gt;= 18</code> and then use a <code class="highlighter-rouge">Lens</code> to modify their name:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">monocle.unsafe.UnsafeSelect</span>
<span class="k">import</span> <span class="nn">monocle.macros.GenLens</span>

<span class="o">(</span><span class="nv">UnsafeSelect</span><span class="o">.</span><span class="py">unsafeSelect</span><span class="o">[</span><span class="kt">Person</span><span class="o">](</span><span class="nv">_</span><span class="o">.</span><span class="py">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="o">)</span> <span class="n">composeLens</span> <span class="nc">GenLens</span><span class="o">[</span><span class="kt">Person</span><span class="o">](</span><span class="nv">_</span><span class="o">.</span><span class="py">name</span><span class="o">)).</span><span class="py">modify</span><span class="o">(</span><span class="s">"Adult "</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
</code></pre></div></div>

<p>This operator is considered unsafe because it allows for inconsistency if a <code class="highlighter-rouge">Lens</code> is then used to change one of the values used in the predicates. For example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">monocle.unsafe.UnsafeSelect</span>
<span class="k">import</span> <span class="nn">monocle.macros.GenLens</span>

<span class="o">(</span><span class="nv">UnsafeSelect</span><span class="o">.</span><span class="py">unsafeSelect</span><span class="o">[</span><span class="kt">Person</span><span class="o">](</span><span class="nv">_</span><span class="o">.</span><span class="py">age</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="o">)</span> <span class="n">composeLens</span> <span class="nc">GenLens</span><span class="o">[</span><span class="kt">Person</span><span class="o">](</span><span class="nv">_</span><span class="o">.</span><span class="py">age</span><span class="o">)).</span><span class="py">set</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</code></pre></div></div>

<p>In this example the age is reset to <code class="highlighter-rouge">0</code> which invalidates the original predicate of <code class="highlighter-rouge">age &gt;= 18</code>. More formally <code class="highlighter-rouge">UnsafeSelect</code> can invalidate the <code class="highlighter-rouge">roundTripOtherWayLaw</code> law.</p>

<h2 id="maptraversal">MapTraversal</h2>

<p><code class="highlighter-rouge">MapTraversal</code> provides an <code class="highlighter-rouge">Iso</code> <code class="highlighter-rouge">allKeyValues</code> between <code class="highlighter-rouge">Map[K,V]</code> and <code class="highlighter-rouge">List([K, V])</code> and Traversal <code class="highlighter-rouge">mapKVTraversal</code> of <code class="highlighter-rouge">Map[K, V]</code> to <code class="highlighter-rouge">(K, V)</code>. They are useful for traversing and modifying the entries of a map.</p>

<p>Both of them are unsafe because of key collision and the unorderness of map entries. As a rule of thumb, laws regarding modifying <code class="highlighter-rouge">(K, V)</code> and then getting back a <code class="highlighter-rouge">List[(K, V)]</code> could be broken, while laws regarding modifying <code class="highlighter-rouge">(K, V)</code> and then getting back a <code class="highlighter-rouge">Map[K, V]</code> could still hold. For example,</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">monocle.unsafe.MapTraversal.allKeyValues</span>

<span class="k">val</span> <span class="nv">list</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">list2</span> <span class="k">=</span> <span class="o">(</span><span class="n">allKeyValues</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">].</span><span class="py">get</span> <span class="k">_</span> <span class="n">compose</span> <span class="n">allKeyValues</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">].</span><span class="py">reverseGet</span><span class="o">)(</span><span class="n">list</span><span class="o">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">list</code> and <code class="highlighter-rouge">list2</code> does not equal here due to key collision. Even if there is no key collision, the output list is still not guaranteed to be the original list as the order of map entries may be unspecified.</p>

<p>On the other hand, the composition of <code class="highlighter-rouge">reverseGet</code> and <code class="highlighter-rouge">get</code> is identity.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">monocle.unsafe.MapTraversal.allKeyValues</span>

<span class="k">val</span> <span class="nv">map</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="s">"foo"</span><span class="o">,</span> <span class="mi">1</span> <span class="o">-&gt;</span> <span class="s">"bar"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">map2</span> <span class="k">=</span> <span class="o">(</span><span class="n">allKeyValues</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">].</span><span class="py">reverseGet</span> <span class="k">_</span> <span class="n">compose</span> <span class="n">allKeyValues</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">].</span><span class="py">get</span><span class="o">)(</span><span class="n">map</span><span class="o">)</span>
</code></pre></div></div>

<p>Here is an example of how to modify the keys of a map with Monocle. Keep in mind creating identical keys can result in surprising behaviour.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">monocle.Traversal</span>
<span class="k">import</span> <span class="nn">monocle.unsafe.MapTraversal.allKeyValues</span>

<span class="k">val</span> <span class="nv">eachL</span> <span class="k">=</span> <span class="nv">Traversal</span><span class="o">.</span><span class="py">fromTraverse</span><span class="o">[</span><span class="kt">List</span>, <span class="o">(</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">)]</span>
<span class="k">def</span> <span class="nf">f</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">String</span><span class="o">))</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="nv">x</span><span class="o">.</span><span class="py">_1</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="nv">x</span><span class="o">.</span><span class="py">_2</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="s">"foo"</span><span class="o">,</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="s">"bar"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">l</span> <span class="k">=</span> <span class="n">allKeyValues</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">].</span><span class="py">get</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">l2</span> <span class="k">=</span> <span class="nv">eachL</span><span class="o">.</span><span class="py">modify</span><span class="o">(</span><span class="n">f</span><span class="o">)(</span><span class="n">l</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">m2</span> <span class="k">=</span> <span class="n">allKeyValues</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">].</span><span class="py">reverseGet</span><span class="o">(</span><span class="n">l2</span><span class="o">)</span>
</code></pre></div></div>
</section></div></div></div></div><script src="/Monocle/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'optics-dev/Monocle'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/Monocle/js/docs.js"></script></body></html>